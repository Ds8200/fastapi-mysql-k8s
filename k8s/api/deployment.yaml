apiVersion: apps/v1
kind: Deployment
metadata:
  name: fastapi
  # Deployment מנהל את ה-Pods של FastAPI
  # ניתן להריץ מספר replicas לזמינות גבוהה
spec:
  replicas: 2
  # 2 instances של FastAPI ל-load balancing
  selector:
    matchLabels:
      app: fastapi
  template:
    metadata:
      labels:
        app: fastapi
    spec:
      containers:
        - name: api
          # תמונת FastAPI (צריך לבנות עם Docker)
          image: fastapi-mysql:latest
          # Never = השתמש בתמונה מקומית בלבד (לא למשוך מ-registry)
          imagePullPolicy: Never
          ports:
            - containerPort: 8000
              # פורט ברירת המחדל של FastAPI
          # הזרקת משתני סביבה מ-ConfigMap ו-Secret
          # כך FastAPI יודע איך להתחבר ל-MySQL
          envFrom:
            - configMapRef:
                name: mysql-config
            - secretRef:
                name: mysql-secret

